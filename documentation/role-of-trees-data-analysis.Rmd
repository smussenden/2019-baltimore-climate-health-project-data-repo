---
title: "Role of Trees Analysis"
author: "Roxanne Ready, Sean Mussenden | Howard Center for Investigative Journalism"
date: "8/6/2019"
output: 
  html_document: 
    keep_md: true
---

## Introduction

This R markdown document describes the methodology and results of a portion of the data analysis we conducted in support of a reporting project examining the effects of tree canopy inequity across the city of Baltimore, especially as it relates to climate change.

## Setup

Before running this file, **please view and run the [cleaning script](https://github.com/smussenden/2019-baltimore-climate-health-project-data-repo/blob/master/documentation/code-red-data-cleaning.md)** for this project. As well as outputting necessary cleaned data for the following ananlysis, that document also includes the following items necessary to understand this analysis: 

* definitions
* information about the source data 
* cleaning methodology 
* software tools

```{r echo=TRUE, message=FALSE}
#######################
#### Load Packages ####
#######################

library(tidyverse)
require(scales) # For percent labeling on distribution tables
library(DescTools) # For %like% operator
#library(here) # For cleaner file path writing

# Turn off scientific notation in RStudio (prevents coersion to character type)
options(scipen = 999)

#########################
#### Store Variables ####
#########################

#### Common save path ####
path_to_data <- "../data/output-data/cleaned/"

###################
#### Load Data ####
###################

blocks_tree_temp_demographics <- 
  read_csv(paste0(path_to_data, "blocks_tree_temp_demographics.csv")) %>%
  mutate_at(vars(matches("geoid10")), as.character) # Recast non-calculable variables as characters

csa_tree_temp_demographics <- 
  read_csv(paste0(path_to_data, "csa_tree_temp_demographics.csv"))

nsa_tree_temp <- 
  read_csv(paste0(path_to_data, "nsa_tree_temp.csv"))

zcta_tree_temp_demographics <- 
  read_csv(paste0(path_to_data, "zcta_tree_temp_demographics.csv")) %>%
  mutate_at(vars(matches("zcta")), as.character) # Recast non-calculable variables as characters

street_trees_nsa_categorized <- 
  read_csv(paste0(path_to_data, "street_trees_nsa_categorized.csv"))

```

## Temperature Analysis

### Blocks by temperature 

The following arranges and ranks blocks across the city by temperature in the afternoon of August 29, 2018:

```{r echo=TRUE, message=FALSE}

blocks_tree_temp_demographics %>%
  select(geoid10, temp_mean_aft) %>%
  mutate(rank = rank(-temp_mean_aft)) %>%
  arrange(rank)

```

Below, we see the block on N. Milton Avenue between Oliver and Federal is one of the city's hottest, ranking at 236 out of 13,598 blocks. The block GEOID for this block was pulled from QGIS and breaks down into the following codes:

* State: 24
* County: 510
* Tract: 080301
* Block: 1000

```{r echo=TRUE, message=FALSE}

blocks_tree_temp_demographics %>%
  select(geoid10, temp_mean_aft) %>%
  mutate(rank = rank(-temp_mean_aft)) %>%
  filter(geoid10 == "245100803011000")

```

### Neighborhood Statistical Areas by temperature

The following arranges and ranks NSAs across the city by temperature in the afternoon of August 29, 2018.

First, we can see that all of the top 10 hottest NSAs are located in the south of the city, and many are in the south-east.

```{r echo=TRUE, message=FALSE}

# Top 10 hottest neighborhoods
nsa_tree_temp %>%
  select(nsa_name, temp_mean_aft) %>%
  mutate(rank = rank(-temp_mean_aft)) %>%
  arrange(rank)

```

Looking at the 10 coolest NSAs, we see it is generally true that they are located far to the west and north, on the outskirts of Baltimore.

```{r echo=TRUE, message=FALSE}

# Top 10 coolest neighborhoods
nsa_tree_temp %>%
  select(nsa_name, temp_mean_aft) %>%
  mutate(rank = rank(-temp_mean_aft)) %>%
  arrange(desc(rank))

```

Below we see:

* McElderry Park was the hottest, at 99.4 degrees Fahrenheit.
* Gwynns Falls/Leakin Park was the coolest, at 90.8 degrees Fahrenheit.

```{r echo=TRUE, message=FALSE}

nsa_tree_temp %>%
  select(nsa_name, temp_mean_aft) %>%
  filter((temp_mean_aft == min(temp_mean_aft)) | (temp_mean_aft == max(temp_mean_aft))) %>%
  arrange(desc(temp_mean_aft))

```

The difference in temperatures between the city's hottest and coolest neighborhoods is `r round((min(nsa_tree_temp$temp_mean_aft)) - (max(nsa_tree_temp$temp_mean_aft)), 2)` degrees Fahrenheit.

Below, we see the relative ranks of the Broadway East and Roland Park neighborhoods, placing Roland Park at 263 out of 278 neighborhoods, while Roland Park is ranked at 16.

```{r echo=TRUE, message=FALSE}

nsa_tree_temp %>%
  select(nsa_name, temp_mean_aft) %>%
  mutate(rank = rank(-temp_mean_aft)) %>%
  arrange(rank) %>%
  filter((nsa_name %like% "roland park") | nsa_name %like% ("broadway east"))

```

These data are visualized in the following choropleth map, which was exported from QGIS and prettified slightly in Illustrator:

<img src="../documentation/choropleth-temperature-full-withlines-01.png" width="400" alt="Choropleth map of temperatures across Baltimore NSAs" />

## Tree Canopy Analysis

```{r echo=TRUE, message=FALSE}

```

## Demographics Analysis

```{r echo=TRUE, message=FALSE}

```

## Street Trees Analysis

```{r echo=TRUE, message=FALSE}

```

## North Milton Street Trees

```{r echo=TRUE, message=FALSE}

```

## Plots and Graphs
```{r echo=TRUE, message=FALSE}

```