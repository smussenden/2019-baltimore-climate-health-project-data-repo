---
title: "DMH BWI Weather Analysis"
author: "Theresa Diffendal | Howard Center for Investigative Journalism"
date: "8/12/2019"
output: 
  md_document:
    variant: markdown_github
    toc: true
    toc_depth: 3
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    df_print: paged
---

```{r include=FALSE}
# Save this file and run the following line from the Console to output both HTML and .md formats:
# rmarkdown::render('documentation/weather-stations-analysis.Rmd', output_format = 'all')
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, paged.print=TRUE)
```

## Introduction

This R markdown document describes the methodology and results of a portion of the data analysis we conducted in support of a reporting project examining the effects of tree canopy inequity across the city of Baltimore, especially as it relates to climate change.

In general, this document is arranged into analyses of the following categories, though there are some cases where one statistic depends on multiple categories (e.g. the canopy cover in a hot neighborhood):

* 
* 
* 
* 

## Setup

Before running this file, **please view and run the [Code Red Data Cleaning document](https://github.com/smussenden/2019-baltimore-climate-health-project-data-repo/blob/master/documentation/code-red-data-cleaning.md)** for this project. As well as outputting necessary cleaned data for the following ananlysis, that document also includes the following items necessary to understand this analysis: 

* definitions
* source data citation and information
* cleaning methodology 
* software tools used

### Load packages

```{r}
#######################
#### Load Packages ####
#######################

library(tidyverse)
library(DescTools) # For %like% operator
library(corrr) # For correlation matrices
library(colorspace) # For improved color palettes
library(ggplot2) # For graphing
library(ggrepel) # For graph labeling
library(stringr)
library(lubridate) #change dates into workable format
library(readxl) #to read excel files
library(janitor)
library(weathermetrics)
library(reshape)
library(writexl) #to write excel files
require(scales) # For percent labeling on distribution tables

# Turn off scientific notation in RStudio (prevents coersion to character type)
options(scipen = 999)
```

### Load variables and data

``` {r}
#########################
#### Store Variables ####
#########################

#### Common path to data ####
path_to_data <- "../data/input-data/baltimore-weather-stations/"

###################
#### Load Data ####
###################

bwi_data <- 
  read_csv(paste0(path_to_data, "BWI-1-1-45-current.csv"))

dmh_data <- 
  read_csv(paste0(path_to_data, "DMH-5-1-98-current.csv"))

###################
#### Clean Data ####
###################

# Clean BWI data 
clean_bwi_data <- bwi_data %>%
  filter(tmpf != 'M', dwpf != 'M') %>%
  mutate(tmpf = as.numeric(tmpf),
         dwpf = as.numeric(dwpf)) %>%
  mutate(date = as.Date(valid, format="%Y-%m-%d")) %>%
  mutate(year=year(valid)) %>%
  mutate(month=month(valid)) %>%
  mutate(hour=hour(valid)) %>%
  mutate(day=day(valid)) %>%
  mutate(hour=hour(valid)) %>%
  distinct(valid, .keep_all = TRUE) %>%
  mutate(heat_index = heat.index(t=tmpf, dp=dwpf, temperature.metric = "fahrenheit", round=0)) %>%
  mutate(relative_humidity = dewpoint.to.humidity(dp = dwpf, t = tmpf, temperature.metric = "fahrenheit")) %>%
  select(date, year, month, day, hour, tmpf, dwpf, relative_humidity, heat_index) %>%
  group_by(date, year, month, day, hour) %>%
  summarise(avg_hourly_temperature_bwi = mean(tmpf),
            avg_hourly_dewpoint_bwi = mean(dwpf),
            avg_hourly_relative_humidity_bwi = mean(relative_humidity),
            avg_hourly_heat_index_bwi = mean(heat_index)
  ) %>%
  filter(!is.na(avg_hourly_relative_humidity_bwi)) %>%
  distinct()

###Save newly clean BWI data and read it in
# write.csv(clean_bwi_data, "../data/output-data/cleaned/clean_bwi_data.csv")

# clean_bwi_data <- read.csv("../data/output-data/cleaned/clean_bwi_data.csv") %>%
 # mutate(date = as.Date(date, format="%Y-%m-%d"))

#######
############Clean Inner Harbor data 
#######

#Rename new inner harbor columns and change inner harbor columns to numerics so can append new inner harbor data to old
renamed_dmh_data <- dmh_data %>%
  dplyr::rename(LOCATION = station,
         DATETIME = valid,
         TEMPERATURE = tmpf,
         DEW_POINT = dwpf,
         RELATIVE_HUMIDITY = relh)

clean_inner_harbor_data <- renamed_dmh_data %>%
  filter(TEMPERATURE != 'M', DEW_POINT != 'M') %>%
  mutate(TEMPERATURE = as.numeric(TEMPERATURE),
         DEW_POINT = as.numeric(DEW_POINT)) %>%
  mutate(date = as.Date(DATETIME, format="%Y-%m-%d")) %>%
  mutate(year=year(DATETIME)) %>%
  mutate(month=month(DATETIME)) %>%
  mutate(hour=hour(DATETIME)) %>%
  mutate(day=day(DATETIME)) %>%
  mutate(hour=hour(DATETIME)) %>%
  distinct(DATETIME, .keep_all = TRUE) %>%
  mutate(heat_index = heat.index(t=TEMPERATURE, dp=DEW_POINT, temperature.metric = "fahrenheit", round=0)) %>%
  mutate(relative_humidity = dewpoint.to.humidity(dp = DEW_POINT, t = TEMPERATURE, temperature.metric = "fahrenheit")) %>%
  select(date, year, month, day, hour, TEMPERATURE, DEW_POINT, relative_humidity, heat_index) %>%
  group_by(date, year, month, day, hour) %>%
  summarise(avg_hourly_temperature_dmh = mean(TEMPERATURE),
            avg_hourly_dewpoint_dmh = mean(DEW_POINT),
            avg_hourly_relative_humidity_dmh = mean(relative_humidity),
            avg_hourly_heat_index_dmh = mean(heat_index)
  ) %>%
  filter(!is.na(avg_hourly_relative_humidity_dmh)) %>%
  distinct()

####Save and load clean inner harbor data
# write_csv(clean_inner_harbor_data, "../data/output-data/cleaned/clean_inner_harbor_data.csv")

# clean_inner_harbor_data <- read.csv("../data/output-data/cleaned/clean_inner_harbor_data.csv") %>%
  # mutate(date = as.Date(date, format="%Y-%m-%d"))
```

## Estimate Inner Harbor Temperature

* Join the 20 years of DMH data to the 20 years of BWI data.  
* Join on date and hour, so we end up with a data frame of values for both DMH and BWI for each date and hour in our data set.  
* Do an inner join, so that if for some reason DMH is missing an hour from its data set (or vice versa), it doesn't mess up our averages. 
* Calculate new columns with difference in temperature, dew point, relative humidity and heat index between BWI and DMH.  
* Since in almost all cases BWI will be colder than DMH, make it so the difference is positive if DMH is greater than BWI.

```{r}
#Join the cleaned data sets
dmhbwi <- 
  inner_join(clean_bwi_data, clean_inner_harbor_data, by = c("date", "hour")) %>%
  dplyr::rename(year = year.x, month = month.x, day = day.x) %>%
  select(-year.y, -month.y, -day.y) %>%
  mutate(tempDiff = avg_hourly_temperature_dmh - avg_hourly_temperature_bwi,
         dewDiff = avg_hourly_dewpoint_dmh - avg_hourly_dewpoint_bwi,
         rhDiff = avg_hourly_relative_humidity_dmh - avg_hourly_relative_humidity_bwi,
         hiDiff = avg_hourly_heat_index_dmh - avg_hourly_heat_index_bwi) 

# Group by month and hour and calculate the AVERAGE difference in temperature, dew point, relative humidity and heat index. 
summarized_join <- dmhbwi %>%
  group_by(month, hour) %>%
  summarize(avgTempDiff = mean(tempDiff),
         avgDewDiff = mean(dewDiff),
         avgRhDiff = mean(rhDiff),
         avgHiDiff = mean(hiDiff))
  
# Go back to the original 75 years of BWI data (after it's been cleaned).  Write case when function adjusting the temperature and dew point values based on table created in step 4. Create two new columns to recalculate heat index and relative humidity (see cleaning function above, weathermetrics package has a nice way of doing this). Call them adjusted_heat_index, adjusted_relative_humidity 
join_bwi_data <-
 inner_join(summarized_join, clean_bwi_data, by = c("month", "hour")) %>%
  mutate(adjusted_temp = avg_hourly_temperature_bwi + avgTempDiff,
         adjusted_dew = avg_hourly_dewpoint_bwi + avgDewDiff,
         adjusted_heat_index = heat.index(t=adjusted_temp, dp=adjusted_dew, temperature.metric = "fahrenheit", round=0),
         adjusted_relative_humidity = dewpoint.to.humidity(dp = adjusted_dew, t = adjusted_temp, temperature.metric = "fahrenheit"))

#Take new adjusted columns and put into a new table as estimates for inner harbor data
estimated_inner_harbor_data <- join_bwi_data %>%
  select(-avgTempDiff, -avgDewDiff, -avgRhDiff, -avgHiDiff, -avg_hourly_temperature_bwi, 
         -avg_hourly_dewpoint_bwi, -avg_hourly_relative_humidity_bwi, -avg_hourly_heat_index_bwi)
# %>% select(-X)

#Check estimated data against cleaned inner harbor data
compare_inner_harbor_data <- estimated_inner_harbor_data %>%
  right_join(clean_inner_harbor_data, by = c("date", "hour")) %>%
  mutate(difference_temp = adjusted_temp - avg_hourly_temperature_dmh,
         difference_dew = adjusted_dew - avg_hourly_dewpoint_dmh,
         difference_rh = adjusted_relative_humidity - avg_hourly_relative_humidity_dmh,
         difference_hi = adjusted_heat_index - avg_hourly_heat_index_dmh)

summarized_compare <- compare_inner_harbor_data %>%
  group_by(year.x, month.x) %>%
  filter(adjusted_heat_index != "NA") %>%
  summarize(avg_difference_temp = mean(difference_temp),
            avg_difference_dew = mean(difference_dew),
            avg_difference_rh = mean(difference_rh),
            avg_difference_ri = mean(difference_hi))

#rename some column names
estimated_inner_harbor_data <- estimated_inner_harbor_data %>%
  dplyr::rename(avg_hourly_temperature_dmh = adjusted_temp,
         avg_hourly_dewpoint_dmh = adjusted_dew,
         avg_hourly_relative_humidity_dmh = adjusted_relative_humidity,
         avg_hourly_heat_index_dmh = adjusted_heat_index) 

#Save inner harbor data
# write.csv(estimated_inner_harbor_data, "../data/output-data/cleaned/estimated_inner_harbor_data.csv")

# estimated_inner_harbor_data <- read.csv("../data/output-data/cleaned/estimated_inner_harbor_data.csv") %>%
 # mutate(date = as.Date(date, format="%Y-%m-%d")) %>%
 # select(-X)
```

#Inner Harbor Questions

* What have the patterns been with 90+, 105+ heat index days?
* What years have had the most of these days?
* What have the longest stretches been?
* Are there more recently that have been intense?

```{r}

#FOR INNER HARBOR
#90+ heat index days? 
hi_over_ninety_dmh <- estimated_inner_harbor_data %>%
  filter(avg_hourly_heat_index_dmh >= 90) %>%
  distinct(date, .keep_all=TRUE) %>%
  group_by(year) %>%
  summarise(count=n()) %>%
  summarise(average_days = mean(count))

#to run ggplot data, take out final summarise statement  
# ggplot(data = hi_over_ninety_dmh, aes(x=year, y=count)) + 
#  geom_col() + 
#  geom_smooth() + 
#  theme(plot.title = element_text(size = 25),
#        axis.title = element_text(size=20),
#        axis.text = element_text(size=15)) +
#  labs(title = "#Days When Heat Index > 90 in Inner Harbor",
#      x = "Year",
#       y = "#Days")
#ggsave(filename = "dmh_days_heat_index_over_ninety.png",
#       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
#       width = 20, height = 15, units = "in")

###similar to above but for hours instead of days
hours_hi_over_ninety_dmh <- estimated_inner_harbor_data %>%
  filter(avg_hourly_heat_index_dmh >= 90) %>%
  group_by(year) %>%
  summarise(count=n())

ggplot(data = hours_hi_over_ninety_dmh, aes(x=year, y=count)) + 
  geom_col() + 
  geom_smooth() + 
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "#Hours When Heat Index > 90 in Inner Harbor",
       x = "Year",
       y = "#Hours")
ggsave(filename = "dmh_hours_heat_index_over_ninety.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in")

#Inner harbor heat index >= 100
hi_over_100_dmh <- estimated_inner_harbor_data %>%
  filter(avg_hourly_heat_index_dmh >= 100) %>%
  distinct(date, .keep_all=TRUE) %>%
  group_by(year) %>%
  summarise(count=n()) %>% 
  summarise(avg_days_per_year = mean(count))

#write_xlsx(hi_over_100_dmh, "/Users/tdiff/Documents/Github/bwi_dmh_temps/data-for-others/hi_over_100_dmh.xlsx")

#to run ggplot data, take out final summarise statement
#ggplot(data = hi_over_100_dmh, aes(x=year, y=count)) + 
#  geom_col() + 
#  geom_smooth() + 
#  theme(plot.title = element_text(size = 25),
#        axis.title = element_text(size=20),
#        axis.text = element_text(size=15)) +
#  labs(title = "#Days When Heat Index > 100 in Inner Harbor",
#       x = "Year",
#       y = "Days")

#ggsave(filename = "dmh_days_heat_index_over_100.png",
#       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
#       width = 20, height = 15, units = "in")

#Inner harbor heat index >= 105
hi_over_105_dmh <- estimated_inner_harbor_data %>%
  filter(avg_hourly_heat_index_dmh >= 105) %>%
  distinct(date, .keep_all=TRUE) %>%
  group_by(year) %>%
  summarise(count=n()) %>%
  summarise(average_days = mean(count))

#to run ggplot data, take out final summarise statement
#ggplot(data = hi_over_105_dmh, aes(x=year, y=count)) + 
#  geom_col() + 
#  geom_smooth() + 
#  theme(plot.title = element_text(size = 25),
#        axis.title = element_text(size=20),
#        axis.text = element_text(size=15)) +
#  labs(title = "#Days When Heat Index > 105 in Inner Harbor",
#       x = "Year",
#       y = "Days")

#ggsave(filename = "dmh_days_heat_index_over_105.png",
#       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
#       width = 20, height = 15, units = "in")

#same as above but for hours, not days
hi_over_103_dmh <- estimated_inner_harbor_data %>%
  filter(avg_hourly_heat_index_dmh >= 103) %>%
  group_by(year, month) %>%
  summarise(count=n())

ggplot(data = hi_over_103_dmh, aes(x=year, y=count)) + 
  geom_col() + 
  geom_smooth() + 
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "#Hours When Heat Index > 103 in Inner Harbor",
       x = "Year",
       y = "#Hours")
ggsave(filename = "dmh_hours_heat_index_over_103.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in")

```

Findings: Looks like 1980s and 1990s had spikes in the amount of days with heat indexes greater than 90 or 103, with current years trending downward. The only months with hi > 103 are June-September. Months with hi>90 range from May-September, with a couple Octobers every now and then, but no more in recent years than in the past

### BWI Heat Index Analysis

* What have the patterns been with 90+, 105+ heat index days?
* What years have had the most of these days?
* What have the longest stretches been?
* Are there more recently that have been intense?

```{r}

# ####BWI DATA####
#BWI over 90 data
hi_over_ninety_bwi <- clean_bwi_data %>%
  #  select(-X) %>%
  filter(avg_hourly_heat_index_bwi >= 90) %>%
  distinct(date, .keep_all=TRUE) %>%
  group_by(year) %>%
  summarise(count=n()) %>%
  summarise(average_days = mean(count))

ggplot(data = hi_over_ninety_bwi, aes(x=year, y=count)) + 
  geom_col() + 
  geom_smooth() + 
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "#Days When Heat Index > 90 in BWI",
       x = "Year",
       y = "Days")
ggsave(filename = "bwi_days_heat_index_over_ninety.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in")

#same as above but #hours instead of days
hours_hi_over_ninety_bwi <- clean_bwi_data %>%
  select(-X) %>%
  filter(avg_hourly_heat_index_bwi >= 90) %>%
  group_by(year) %>%
  summarise(count=n())

ggplot(data = hours_hi_over_ninety_bwi, aes(x=year, y=count)) + 
  geom_col() + 
  geom_smooth() + 
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "#Hours When Heat Index > 90 in BWI",
       x = "Year",
       y = "#Hours")
ggsave(filename = "bwi_hours_heat_index_over_ninety.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in")

#BWI over 100 data
hi_over_100_bwi <- clean_bwi_data %>%
  #select(-X) %>%
  filter(avg_hourly_heat_index_bwi >= 100) %>%
  distinct(date, .keep_all=TRUE) %>%
  group_by(year) %>%
  summarise(count=n()) %>%
  summarise(average_days = mean(count))

ggplot(data = hi_over_100_bwi, aes(x=year, y=count)) + 
  geom_col() + 
  geom_smooth() + 
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "#Days When Heat Index > 100 in BWI",
       x = "Year",
       y = "Days")
ggsave(filename = "bwi_days_heat_index_over_100.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in")

#BWI over 105 data
hi_over_105_bwi <- clean_bwi_data %>%
  #select(-X) %>%
  filter(avg_hourly_heat_index_bwi >= 105) %>%
  distinct(date, .keep_all=TRUE) %>%
  group_by(year) %>%
  summarise(count=n()) %>%
  summarise(average_days = mean(count))

ggplot(data = hi_over_105_bwi, aes(x=year, y=count)) + 
  geom_col() + 
  geom_smooth() + 
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "#Days When Heat Index > 105 in BWI",
       x = "Year",
       y = "Days")
ggsave(filename = "bwi_days_heat_index_over_105.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in")

#same as above but #hours instead of days
hours_hi_over_103_bwi <- clean_bwi_data %>%
  select(-X) %>%
  filter(avg_hourly_heat_index_bwi >= 103) %>%
  group_by(year, month) %>%
  summarise(count=n())

ggplot(data = hours_hi_over_103_bwi, aes(x=year, y=count)) + 
  geom_col() + 
  geom_smooth() + 
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "#Hours When Heat Index > 103 in BWI",
       x = "Year",
       y = "#Hours")
ggsave(filename = "bwi_hours_heat_index_over_103.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in")


```

#Comparing July and August Data

* Have the hottest months of the year (July, August) gotten more hot on average?

```{r}

#INNER HARBOR data for July/August: 
#done by building a multi-line graph by making months into separate columns, joining, and then plotting; geom_smooth lines are easier to read than geom_line
july_dmh <- estimated_inner_harbor_data %>%
  filter(month == 7,
         avg_hourly_heat_index_dmh != "NA") %>%
  group_by(year, month) %>%
  summarise(monthly_average_heat_index_july = mean(avg_hourly_heat_index_dmh))

august_dmh <- estimated_inner_harbor_data %>%
  filter(month ==8,
         avg_hourly_heat_index_dmh != "NA") %>%
  group_by(year, month) %>%
  summarise(monthly_average_heat_index_august = mean(avg_hourly_heat_index_dmh))

july_august_dmh <-
  inner_join(july_dmh, august_dmh, by="year")

ggplot(data = july_august_dmh, aes(x=year)) + 
  geom_smooth(aes(y=monthly_average_heat_index_july, color = "July")) +
  geom_smooth(aes(y=monthly_average_heat_index_august, color = "August")) + 
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "Inner Harbor July and August Average Heat Indexes",
       x = "Year",
       y = "Average Heat Index")

ggsave(filename = "dmh_july_august_heat_indexes_smoothed.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in")

##BWI July/August Average Heat Index Data
july_bwi <- clean_bwi_data %>%
  filter(month == 7) %>%
  group_by(year, month) %>%
  summarise(monthly_average_heat_index_july = mean(avg_hourly_heat_index_bwi))

august_bwi <- clean_bwi_data %>%
  filter(month ==8) %>%
  group_by(year, month) %>%
  summarise(monthly_average_heat_index_august = mean(avg_hourly_heat_index_bwi))

july_august_bwi <-
  inner_join(july_bwi, august_bwi, by="year")

ggplot(data = july_august_bwi, aes(x=year)) + 
  geom_smooth(aes(y=monthly_average_heat_index_july, color = "July")) +
  geom_smooth(aes(y=monthly_average_heat_index_august, color = "August")) + 
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "BWI July and August Average Heat Indexes",
       x = "Year",
       y = "Average Heat Index")

ggsave(filename = "bwi_july_august_heat_indexes_smoothed.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in")

```

Findings: It does seem that the average heat index in July and August are rising, but they're rising back to a level reached about 70 years ago

## How many days have not had a heat index BELOW 80 degrees, even at night?

* Use the minimum heat index value for each day using summarise
* Are there more frequent recent stretches?

```{r}


#Data for BWI
bwi_days_above_80 <- clean_bwi_data %>%
  group_by(year, date) %>%
  summarise(min_heat_index = min(avg_hourly_heat_index_bwi)) %>%
  filter(min_heat_index >= 80) %>%
  summarise(bwi_days=n())
#count is 52

ggplot(data=bwi_days_above_80, aes(x=year, y=bwi_days)) + 
  geom_col() + 
  geom_smooth() + 
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "BWI #Days With Minimum Heat Index Above 80 Degrees",
       x = "Year",
       y = "Number of Days")

ggsave(filename = "bwi_days_above_80_col.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in")

#Data for dmh
dmh_days_above_80 <- estimated_inner_harbor_data %>%
  group_by(year, date) %>%
  summarise(min_heat_index = min(avg_hourly_heat_index_dmh)) %>%
  filter(min_heat_index >= 80) %>%
  summarise(dmh_days=n())
#count is 322

ggplot(data=dmh_days_above_80, aes(x=year, y=dmh_days)) + 
  geom_col() + 
  geom_smooth() + 
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "Inner Harbor Number of Days Where Heat Index Stayed Above 80 Degrees",
       x = "Year",
       y = "Number of Days")

ggsave(filename = "dmh_days_above_80_col.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in")

days_above_80 <- full_join(dmh_days_above_80, bwi_days_above_80, by=c("year"))
days_above_80[is.na(days_above_80)] <- 0

ggplot(data=days_above_80, aes(x=year)) + 
  geom_smooth(aes(y=dmh_days, fill = "Inner Harbor")) +
  geom_smooth(aes(y=bwi_days, fill = "BWI")) +
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "Number of Days Where Heat Index Stayed Above 80 Degrees",
       x = "Year",
       y = "Number of Days")

ggsave(filename = "days_above_80_smoothed.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in")

#tried using geom_col, but data wouldn't change when position set to dodge. Tried to melt but didn't work

#melt_days_above_80 <- melt(days_above_80, id = c("year"), measure=c("dmh_days", "bwi_days"))

```

#Temperature Differences

* First, day to night temp differences between BWI and inner harbor on July 2, 2019, hottest day we have on data for 2019 so far

```{r}
## July 2, 2019
daily_temp_differences <-
  left_join(clean_inner_harbor_data, clean_bwi_data, by=c("date", "hour")) %>%
  dplyr::rename(year = year.x, month = month.x, day = day.x) %>%
  select(-year.y, -month.y, -day.y) %>%
  filter(date == "2019-07-02")

  daily_temp_differences[is.na(daily_temp_differences)] <- 0 

ggplot(data=daily_temp_differences, aes(x=hour)) + 
  geom_line(aes(y=avg_hourly_heat_index_dmh, color = "Inner Harbor")) +
  geom_line(aes(y=avg_hourly_heat_index_bwi, color = "BWI")) +
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "Heat Index Differences 2019-07-02",
       x = "Hour",
       y = "Heat Index")

ggsave(filename = "heat_index_differences_july_second.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in")

#Average differences in weather recordings between BWI and DMH for the month of July, 2018
twenty_eighteen_temp_differences <-
  left_join(clean_inner_harbor_data, clean_bwi_data, by=c("date", "hour")) %>%
  dplyr::rename(year = year.x, month = month.x, day = day.x) %>%
  select(-year.y, -month.y, -day.y) %>%
  filter(year == "2018",
         month == "7") %>%
  mutate(HiDiff = avg_hourly_heat_index_dmh - avg_hourly_heat_index_bwi) %>%
  group_by(hour) %>%
  summarise(meanDifference = mean(HiDiff))

ggplot(data=twenty_eighteen_temp_differences, aes(x=hour, y=meanDifference)) + 
  geom_line() +
  theme(plot.title = element_text(size = 25),
        axis.title = element_text(size=20),
        axis.text = element_text(size=15)) +
  labs(title = "Average Heat Index Differences in July 2018",
       subtitle = "Inner Harbor - BWI",
       x = "Hour",
       y = "Heat Index")

ggsave(filename = "heat_index_differences_july_twenty_eighteen.png",
       device = "png", path = "/Users/tdiff/Documents/Github/bwi_dmh_temps/Graphs",
       width = 20, height = 15, units = "in") 


```
